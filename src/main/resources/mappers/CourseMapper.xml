<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="inflearn_clone.springboot.mappers.CourseMapper">

    <select id="courseList" resultType="inflearn_clone.springboot.domain.CourseVO">
        SELECT
            idx, category, title, description, teacherId, regDate, displayDate, status, price, thumbnail
        FROM tbl_course
        WHERE status = 'Y'
        ORDER BY regDate DESC;
    </select>

    <select id="courseView" parameterType="int" resultType="inflearn_clone.springboot.domain.CourseVO">
        SELECT
            idx, category, title, description, teacherId, regDate, displayDate, modifyDate, price, thumbnail
        FROM tbl_course
        WHERE idx = #{idx} AND status = 'Y';
    </select>

    <select id="courseTotalCnt" resultType="int">
        SELECT COUNT(*)
        FROM tbl_course
        <where>
            <if test="searchCategory != null and searchCategory != ''">
                category = #{searchCategory}
            </if>
            <if test="searchValue != null and searchValue != ''">
                AND (
                title LIKE CONCAT('%', #{searchValue}, '%') OR
                teacherId LIKE CONCAT('%', #{searchValue}, '%')
                )
            </if>
        </where>
    </select>

    <select id="selectAllCourse" resultType="inflearn_clone.springboot.domain.CourseVO">
        SELECT
        idx, category, title, description, teacherId, regDate, displayDate, status, price, thumbnail
        FROM tbl_course
        <where>
            <if test="searchCategory != null and searchCategory != ''">
                category = #{searchCategory}
            </if>
            <if test="searchValue != null and searchValue != ''">
                AND (
                title LIKE CONCAT('%', #{searchValue}, '%') OR
                teacherId LIKE CONCAT('%', #{searchValue}, '%')
                )
            </if>
        </where>
        ${sortQuery}
        LIMIT #{offset}, #{limit}
    </select>

</mapper>

