<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="inflearn_clone.springboot.mappers.CourseMapper">
    <!-- 강좌 리스트 조회 -->
    <select id="courseList" resultType="inflearn_clone.springboot.domain.CourseVO">
        SELECT
            idx, category, title, description, teacherId, regDate, displayDate, status, price, thumbnail
        FROM tbl_course
        WHERE status = 'Y'
        ORDER BY regDate DESC;
    </select>

    <!-- 코스 상세 조회 -->
    <select id="getCourseDetail" parameterType="int" resultType="inflearn_clone.springboot.domain.CourseVO">
        SELECT
            idx, category, title, description, teacherId, regDate, displayDate, modifyDate, price, thumbnail
        FROM tbl_course
        WHERE idx = #{idx} AND status = 'Y';
    </select>

    <!--teacherId로 존재하는 강의가 있는지 확인-->
    <select id="selectCourseByMemberId" resultType="Integer">
        SELECT idx
        FROM tbl_course
        WHERE teacherId = #{teacherId};
    </select>

    <!--teacherId에 해당하는 강의 비활성화로 변경-->
    <update id="deleteCourseByMemberId">
        UPDATE tbl_course
        SET status = 'N'
        WHERE teacherId = #{teacherId} AND status = 'Y';
    </update>

    <!-- 강의 삭제 날짜 업데이트-->
    <update id="updateDeleteDate">
        UPDATE tbl_course
        SET deleteDate = #{deleteDate}, status = 'R'
        WHERE idx = #{idx}
    </update>

    <!-- 강의 상태 업데이트 -->
    <update id="updateCourseStatusToDeleted">
        UPDATE tbl_course
        SET status = 'D'
        WHERE deleteDate &lt;= #{now}
        AND status != 'D'
    </update>
</mapper>

