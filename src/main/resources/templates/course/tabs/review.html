<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
>
<style>
    .review-container {
        font-family: Arial, sans-serif;
        margin: 20px;
    }

    .review-sort {
        margin-bottom: 10px;
    }

    .review-list {
        border-top: 1px solid #ccc;
    }

    .review-item {
        border-bottom: 1px solid #ccc;
        padding: 10px 0;
    }

    .review-header {
        font-size: 14px;
        margin-bottom: 5px;
    }

    .review-author {
        font-weight: bold;
        margin-right: 10px;
    }

    .review-rating {
        color: gold;
        margin-right: 10px;
    }

    .review-content p {
        margin: 0;
    }

    .review-actions {
        margin-top: 10px;
    }

    .review-more {
        text-align: center;
        margin-top: 10px;
    }
</style>
<div class="review-container">
    <!-- 정렬 드롭다운 -->
    <div class="review-sort">
        <label for="sortBy">정렬:</label>
        <select id="sortBy" onchange="sortReviews()">
            <option value="latest" th:selected="${sortBy == 'latest'}">최신순</option>
            <option value="rating_desc" th:selected="${sortBy == 'rating_desc'}">평점높은순</option>
            <option value="rating_asc" th:selected="${sortBy == 'rating_asc'}">평점낮은순</option>
        </select>
    </div>
    <input type="hidden" id="courseIdx" value="${courseIdx}">
    <!-- 리뷰 목록 -->
    <div th:if="${#lists.isEmpty(reviews)}">
        <p>등록된 수강평이 없습니다.</p>
    </div>
    <div class="review-list" th:unless="${#lists.isEmpty(reviews)}">
        <div th:each="review : ${reviews}" class="review-item">
            <!-- 작성자 정보 -->
            <div class="review-header">
                <span class="review-author" th:text="${review.memberName}"></span>
                <span class="review-rating">
                    <span th:each="i : ${#numbers.sequence(1, review.rating)}">★</span>
                </span>
                <span class="review-date" th:text="${#temporals.format(review.regDate, 'yyyy-MM-dd')}"></span>
            </div>

            <!-- 리뷰 내용 -->
            <div class="review-content">
                <p th:text="${review.content}"></p>
            </div>

            <!-- 수정 및 삭제 버튼 -->
<!--            <div class="review-actions" th:if="${review.memberId == MemberId}">-->
            <div class="review-actions">
                <button class="edit-btn" data-idx="${review.idx}" onclick="openEditModal(this)">수정</button>                <form action="/review/delete" method="POST" style="display:inline;">
                    <input type="hidden" name="idx" th:value="${review.idx}">
                    <input type="hidden" name="courseIdx" th:value="${courseIdx}">
                    <button type="submit" onclick="return confirm('정말로 이 리뷰를 삭제하시겠습니까?');">삭제</button>
                </form>
            </div>
        </div>

    <!-- 수정 모달 창 -->
    <div id="editModal" class="modal4" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeModal('editModal')">&times;</span>
            <form id="editForm" method="POST" action="/review/modify">
                <input type="hidden" id="idx" name="idx">
                <input type="hidden" name="courseIdx" th:value="${courseIdx}">
                <label for="content">내용:</label>
                <textarea id="content" name="content" rows="4"></textarea>
                <label for="rating">평점:</label>
                <input type="number" id="rating" name="rating" min="1" max="5">
                <button type="submit">수정</button>
            </form>
        </div>
    </div>


    <!-- 더보기 버튼 -->
    <div class="review-more">
        <button id="loadMore" onclick="loadMoreReviews()">더 보기</button>
    </div>

    <script>
        function sortReviews() {
            const sortBy = document.getElementById("sortBy").value;
            const courseIdx = [[${courseIdx}]];

            window.location.href = `/course/tab/review/${courseIdx}?sortBy=${sortBy}`;
        }

        function modifyGo(reviewIdx) {
            window.location.href = `/review/edit/${reviewIdx}`;
        }

        // function openModal(modalId) {
        //     console.log("어픈확인")
        //     document.getElementById(modalId).style.display = "block";
        // }
        //
        // function openEditModal(idx) {
        //     fetch(`/review/${idx}`)
        //         .then(response => response.json())
        //         .then(data => {
        //             document.getElementById("editForm").action = "/review/modify";
        //             document.getElementById("idx").value = data.idx;
        //             document.getElementById("content").value = data.content;
        //             document.getElementById("rating").value = data.rating;
        //             openModal('editModal');
        //         })
        //         .catch(error => console.error("Error loading review:", error));
        // }
        //
        // function closeModal(modalId) {
        //     document.getElementById(modalId).style.display = "none";
        // }

    </script>
</div>

</html>