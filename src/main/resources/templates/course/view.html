<!DOCTYPE html>
<html lang="ko"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{layout/layout.html}"
>
<div layout:fragment="main">
<!--    <div >-->
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="/css/course/courseViewStyle.css">
        <div class="content2">
            <!-- ìƒë‹¨: ê°•ì˜ëª… + ì¸ë„¤ì¼ -->
            <div class="header">
                <div class="course-info">
                    <h1 th:text="${course.title}">ê°•ì˜ëª…</h1>
                    <p>â­ë³„ì <span></span>  ìˆ˜ê°•ìƒ:<span th:text="${studentCnt}"></span>ëª…</p>
                    <p>ğŸ‘¤ ê°•ì‚¬ëª…: <span th:text="${course.teacherId}"></span></p>
                </div>
                <div class="thumbnail">
                    <img th:src="${course.thumbnail}" alt="ê°•ì˜ ì¸ë„¤ì¼">
                </div>
            </div>

            <!-- ì¤‘ì•™: íƒ­ ì˜ì—­ -->
            <div class="tabs">
                <button class="tab" data-tab="info">ê°•ì˜ì†Œê°œ</button>
                <button class="tab" data-tab="curriculum">ì»¤ë¦¬í˜ëŸ¼</button>
                <button class="tab" data-tab="qna">Q&A</button>
                <button class="tab" data-tab="review">ìˆ˜ê°•í‰</button>
                <button class="tab" data-tab="notice">ê³µì§€ì‚¬í•­</button>
            </div>

            <!-- ì¤‘ì•™: ë³€ê²½ë  ì½˜í…ì¸  ì˜ì—­ -->
            <div class="tab-content">
                <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë  ì½˜í…ì¸  -->
            </div>

            <!-- ìš°ì¸¡: ì‚¬ì´ë“œë°” -->
            <div class="sidebar">
                <h2 th:text="'â‚©' + ${#numbers.formatInteger(course.price, 0, 'COMMA')}"> ê°€ê²©</h2>
                <form action="/cart/regist" method="post" th:if="${isCartPossible && isOrderPossible}">
                    <input type="hidden" name="courseIdx" th:value="${course.idx}">
                    <button type="submit" class="btn1">ìˆ˜ê°•ì‹ ì²­í•˜ê¸°</button>
                </form>

                <form action="/cart/regist" method="post" th:if="${isCartPossible && isOrderPossible}">
                    <input type="hidden" name="courseIdx" th:value="${course.idx}">
                    <button type="submit" class="btn2">ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°</button>
                </form>
                <form action="/cart/list" method="get" th:if="${!isCartPossible && isOrderPossible}">
                    <button type="submit" class="btn2">ì¥ë°”êµ¬ë‹ˆ ì´ë™</button>
                </form>

                <form action="/review/regit" method="get" th:if="${!isOrderPossible}">
                    <button type="submit" class="btn2">ìˆ˜ê°•í‰ ì‘ì„±í•˜ê¸°</button>
                </form>
                <div class="like">
                  <span class="heart" data-liked="[[${isLiked}]]">
                    <span class="heart-icon">[[${isLiked ? 'â¤ï¸' : 'ğŸ¤'}]]</span>
                </span>
                    <span id="likeCount" th:text="${likeCount}"></span>
                </div>
            </div>
        </div>
    </div>


</html>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    const courseIdx = [[${course.idx}]];

    $(document).ready(function() {
        $('.tab[data-tab="info"]').click();
    });
    // íƒ­ í´ë¦­ ì´ë²¤íŠ¸
    $('.tab').on('click', function () {
        const tabName = $(this).data('tab');
        const idx = courseIdx;
        $.get(`/course/tab/${tabName}/${idx}`, function (data) {
            $('.tab-content').html(data);
        });
    });

    // ì¢‹ì•„ìš” ë²„íŠ¼ í´ë¦­
    $(document).ready(function () {
        $('.heart').on('click', function () {
            const isLiked = $(this).data('liked') === 'true';

            $.post('/like/regist', { courseIdx: courseIdx}, function (response) {
                if (response.success) {
                    const newLikeState = !isLiked;
                    $(this).data('liked', newLikeState);
                    if (newLikeState) {
                        $(this).text('â¤ï¸').css('color', 'red');
                    } else {
                        $(this).text('ğŸ¤').css('color', 'gray');
                    }

                    $('#likeCount').text(response.likeCount);

                } else {
                    alert('ì¢‹ì•„ìš” ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            }.bind(this));
        });
    });
</script>